<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="#">
    <script src="https://kit.fontawesome.com/5ac8e979c0.js" crossorigin="anonymous"></script>

    <script src="https://d3js.org/d3.v7.min.js"></script>



</head>


<body>
    <div class="wrapper">
        <div class="container">
            <section class="albums-container">
                <header class="header">
                    <nav class="header__navigation">
                        <div class="header__navigation-logo"><img src="img/logo.svg" alt="logotype"></div>
                        <div class="header__navigation-search" id="search">
                            <input type="text" id="search-input" placeholder="Search">
                            <button type="submit" id="search-button"><img src="img/Search.svg" alt="search"></button>
                            <a href="#" class="profile"><img src="img/avatar.svg" alt="avatar" class="profile-img"></a>
                        </div>
                    </nav>
                </header>



                <div class="albums-container-albums" id="albums">
                    <h1 class="albums-title">Original Soundtrack</h1>
                    <div id="albumList">
                        <div class="album">
                            <img src="img/Berlin-Calling.jpg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Berlin Calling</h2>
                            <h3 class="album-title__artist">Paul Kalkbrenner</h3>
                        </div>
                        <div class="album">
                            <img src="img/altes.png" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Altes Kamuffel</h2>
                            <h3 class="album-title__artist">Paul Kalkbrenner</h3>
                        </div>
                        <div class="album">
                            <img src="img/icke.jpg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Icke Wieder</h2>
                            <h3 class="album-title__artist">Paul Kalkbrenner</h3>
                        </div>
                        <div class="album">
                            <img src="img/prokofiev.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Best Works</h2>
                            <h3 class="album-title__artist">Sergey Prokofiev</h3>
                        </div>
                        <div class="album">
                            <img src="img/rachmaninov.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Very Best of Rachmaninoff</h2>
                            <h3 class="album-title__artist">Sergey Rachmaninoff</h3>
                        </div>
                        <div class="album">
                            <img src="img/Khachaturian.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Masquerade Waltz</h2>
                            <h3 class="album-title__artist">Aram Khachaturian</h3>
                        </div>
                        <div class="album">
                            <img src="img/haydn.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Best of Haydn</h2>
                            <h3 class="album-title__artist">Joseph Haydn</h3>
                        </div>
                        <div class="album">
                            <img src="img/chopin.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">The Best of Chopin</h2>
                            <h3 class="album-title__artist">Frédéric Chopin</h3>
                        </div>
                        <div class="album">
                            <img src="img/recondite.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Iffy</h2>
                            <h3 class="album-title__artist">Recondite</h3>
                        </div>
                        <div class="album">
                            <img src="img/shxcxchcxsh.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Linear S Decoded</h2>
                            <h3 class="album-title__artist">shxcxchcxsh</h3>
                        </div>
                        <div class="album">
                            <img src="img/kohlstedt.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Tag Remixes</h2>
                            <h3 class="album-title__artist">Martin Kohlstedt</h3>
                        </div>
                        <div class="album">
                            <img src="img/lambert.jpeg" alt="album-cover" class="album-cover">
                            <h2 class="album-title">Open</h2>
                            <h3 class="album-title__artist">Lambert</h3>
                        </div>
                    </div>
                </div>
            </section>

            <section id="playlistContainer" class="player-container">
                <button class="play-button"></button>
                <h3 id="song-title">
                </h3>

                <div class="waveform-container">
                    <div id="duration-container" class="waveform-time">
                        <span id="duration-label"></span>
                    </div>
                    <svg id="waveform" width="400" height="48"></svg>
                    <div id="remaining-container" class="waveform-time">
                        <span id="remaining-label"></span>
                    </div>
                </div>
                <div id="player">


                    <audio autoplay id="music-player">
                    </audio>
                    <!-- <div class="waveform-song" id="waveform-song">
                        <div class="equalizer">
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                        </div>
                    </div> -->
                    <div class="playlist" id="playlist">

                    </div>

                </div>
            </section>
        </div>
    </div>


    <script src="index.js"></script>
</body>

<script>
    // waveform

    document.addEventListener("DOMContentLoaded", function () {

        const audioContext = new AudioContext();

        const audio = document.getElementById("music-player");
        const waveform = d3.select("#waveform");
        const durationLabel = d3.select("#duration-label");
        const remainingLabel = d3.select("#remaining-label");

        let audioSource = null;

        if (audioSource) {
            audioSource.disconnect();
        }

        audioSource = audioContext.createMediaElementSource(audio);

        const analyzer = audioContext.createAnalyser();

        audioSource.connect(analyzer);
        analyzer.connect(audioContext.destination);
        const bufferLength = analyzer.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        // D3
        const xScale = d3.scaleLinear().range([0, waveform.attr("width")]);
        const yScale = d3.scaleLinear().range([waveform.attr("height"), 0]);
        const line = d3.line().x((d, i) => xScale(i)).y(d => yScale(d));
        const path = waveform.append("path").attr("fill", "yellow").attr("stroke", "orange");
        const draw = () => {
            analyzer.getByteTimeDomainData(dataArray);
            path.attr("d", line(dataArray));
            requestAnimationFrame(draw);
        };

        audio.onloadedmetadata = () => {
            const duration = Math.floor(audio.duration);
            const remaining = Math.floor(audio.duration);
            durationLabel.text(formatTime(duration));
            remainingLabel.text(formatTime(remaining));
        }

        audio.ontimeupdate = () => {
            const duration = Math.floor(audio.duration);
            const remaining = Math.floor(audio.duration - audio.currentTime);
            durationLabel.text(formatTime(duration));
            remainingLabel.text(formatTime(remaining));
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds - minutes * 60;
            const formattedSeconds = remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds;
            return `${minutes}:${formattedSeconds}`;
        }

        xScale.domain([0, bufferLength]);
        yScale.domain([0, 255]);

        waveform.style("display", "none");
        durationLabel.style("display", "none");
        remainingLabel.style("display", "none");

        const showWaveform = () => {
            waveform.style("display", "block");
            durationLabel.style("display", "inline-block");
            remainingLabel.style("display", "inline-block");
        };
        const playMusic = () => {
            audio.play();
            draw();
            showWaveform();
        };

        audio.addEventListener('canplay', playMusic);

        const pauseMusic = () => {
            pauseSong();
        };

        document.addEventListener('click', playMusic);
        audio.addEventListener('pause', pauseMusic);
        draw();


    });

// // get the audio player element and create a new audio context
// const player = document.querySelector('#music-player');
// const audioContext = new AudioContext();
// const source = audioContext.createMediaElementSource(player);

// // create the equalizer animation
// const equalizer = document.createElement('div');
// equalizer.classList.add('equalizer');
// for (let i = 0; i < 5; i++) {
//   const bar = document.createElement('div');
//   bar.classList.add('bar');
//   equalizer.appendChild(bar);
// }

// // get the current playing song element and replace its play button with the equalizer animation
// function showEqualizer(songElement) {
//   const playButton = songElement.querySelector('.play-button');
//   if (playButton) {
//     songElement.removeChild(playButton);
//     songElement.appendChild(equalizer);
//   }
// }

// // remove the equalizer animation from the current playing song element
// function hideEqualizer(songElement) {
//   const isHovered = songElement.matches(':hover');
//   const hasEqualizer = songElement.contains(equalizer);
//   if (!isHovered && hasEqualizer) {
//     songElement.removeChild(equalizer);
//     songElement.appendChild(document.createElement('button')).classList.add('play-button');
//   }
// }

// // hide the equalizer animation when the audio is paused or ended
// function hideEqualizerOnPause() {
//   const songElement = document.querySelector('.playsong-li.playing');
//   if (songElement) {
//     const isPaused = player.paused || player.ended;
//     if (isPaused) {
//       hideEqualizer(songElement);
//       songElement.classList.remove('playing');
//     }
//   }
// }

// // update the current playing song element and show/hide the equalizer animation accordingly
// function updatePlayingSong(songElement) {
//   const isPlaying = !player.paused && !player.ended;
//   const isSameSong = songElement === document.querySelector('.playsong-li.playing');
//   if (isPlaying && !isSameSong) {
//     const playingSongElement = document.querySelector('.playsong-li.playing');
//     if (playingSongElement) {
//       hideEqualizer(playingSongElement);
//       playingSongElement.classList.remove('playing');
//     }
//     showEqualizer(songElement);
//     songElement.classList.add('playing');
//   } else if (!isPlaying && isSameSong) {
//     hideEqualizer(songElement);
//     songElement.classList.remove('playing');
//   }
// }

// // update the playing song element and hide the equalizer animation when the audio is paused or ended
// player.addEventListener('pause', hideEqualizerOnPause);
// player.addEventListener('ended', hideEqualizerOnPause);

// // attach the show/hide equalizer functions to the song elements
// const songElements = document.querySelectorAll('.playsong-li');
// songElements.forEach(songElement => {
//   songElement.addEventListener('click', () => {
//     updatePlayingSong(songElement);
//   });
//   songElement.addEventListener('mouseover', () => {
//     const songIsPlaying = songElement.classList.contains('playing');
//     if (!songIsPlaying) {
//       hideEqualizer(songElement);
//     }
//   });
//   songElement.addEventListener('mouseleave', () => {
//     const songIsPlaying = songElement.classList.contains('playing');
//     if (!songIsPlaying) {
//       showEqualizer(songElement);
//     }
//   });
// });



</script>

</html>